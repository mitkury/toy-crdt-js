<!DOCTYPE html>
<html>

<head>
    <title>Toy CRDT Editor</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <script>

        /*
        console.log(1, diff("A", "AB"))
        console.log(1, diff("AB", "A"))
        console.log(1, diff("A", "BA"))
        console.log(1, diff("AB", "B"))
        */

        /*
        console.log(1, diff("AB", "A1B"))
        console.log(1, diff("A1B", "AB"))
        */

        //console.log(3, diff("hello,Â ", "hello, w"))
        //console.log(diff("34", "134"))
        //console.log(diff("1234", "34"))



        console.log(diff("ABC", "A1B"))

        //console.log(diff("A1B", "AB"))

        //console.log(diff("A1B", "A2B"))

        //console.log(diff("A1B", "A2"))



        //console.log(diff("HEY WORLD", "HEY FUCKING WORLD"))

        //console.log(diff("HELLO WORLD", "HEY FUCKING WORLD"))

        /*
        console.log(1, diff("1", "1"))

        console.log(2, diff("1", "12"))

        console.log(3, diff("12", "1234"))
        
        console.log(4, diff("1", "21"))

        console.log(5, diff("oh", "ah"))
       

        // 0 Not replacing
        console.log(1, diff("1", "1"))

        // 1 Append
        console.log(1, diff("Hel", "Hello"))

        // 2 Prepend
        console.log(2, diff("HELLO", "123HELLO"))

        // 3 Delete from right
        console.log(3, diff("Hello", "Hel"))

        // 4 Delete from left
        console.log(4, diff("Hello", "llo"))

        // 5 Replce from left
        console.log(5, diff("Hello", "Hi"))

        // 6 Replace in the middle
        console.log(6, diff("HELLO WORLD", "HEY FUCKING WORLD"))

        // 7 Replace from the left
        console.log(7, diff("HELLO WORLD", "BYE WORLD"))

        // 8 Fully replace
        console.log(8, diff("HELLO", "BYE"))

        // 9 Remove everything
        console.log(9, diff("HELLO", ""))

        // 9 Add
        console.log(10, diff("", "HELLO"))
 */

        function diff(oldStr, newStr) {
            if (oldStr === newStr) {
                return [0, '', 0]
            }

            const oldLength = oldStr.length
            const newLength = newStr.length
            const largestLength = newStr.length > oldStr.length ? newStr.length : oldStr.length
            const newIsLongerThanOld = newLength > oldLength

            let start = -1
            for (let i = 0; i < largestLength; i++) {
                if (oldStr.charAt(i) !== newStr.charAt(i)) {
                    start = i;
                    break;
                }
            }

            // Added at the end
            if (newIsLongerThanOld && start >= oldLength) {
                console.log("Added at the end")
                return [oldLength, newStr.substr(start, newLength - oldLength), 0]
            }

            // Removed at the end
            if (!newIsLongerThanOld && start >= newLength) {
                console.log("Removed at the end")
                return [newLength, '', oldLength - newLength]
            }

            let end = -1
            let oldIdx = oldLength - 1
            let newIdx = newLength - 1
            let i = largestLength - 1
            while (i > 0) {
                if (oldStr.charAt(oldIdx) !== newStr.charAt(newIdx)) {
                    end = i
                    break
                }

                oldIdx--
                newIdx--
                i--
            }

            // Added at the start
            if (newIsLongerThanOld && end <= newLength - oldLength - 1) {
                console.log("Added at the start")
                return [0, newStr.substr(0, newLength - oldLength), 0]
            }

            // Removed at the start
            if (!newIsLongerThanOld && end <= oldLength - newLength - 1) {
                console.log("Removed at the start")
                return [0, '', oldLength - newLength]
            }

            // Removed, replaced or inserted

            const newStrRange = newIdx - start
            const addedStr = newStr.substr(start, end)
            const replacementRange = end - start + 1
           
            return [start, addedStr, replacementRange]

            /*
            let start = -1
            const largestLength = newStr.length > oldStr.length ? newStr.length : oldStr.length

            // Scan from left to right to find an index where the diff starts
            // The start is the index where the change starts
            for (let i = 0; i < largestLength; i++) {
                if (oldStr.charAt(i) !== newStr.charAt(i)) {
                    start = i;
                    break;
                }
            }

            // Scan from right to left to find ends in new and old strings
            // The end is the index where the change didn't start yet and the char
            // on the left to that index (index - 1) is changed.
            let newEnd = newStr.length
            let end = oldStr.length
            for (let i = oldStr.length - 1; i >= 0; i--) {
                if (oldStr.charAt(i) !== newStr.charAt(newEnd - 1)) {
                    break;
                }

                end--
                newEnd--
            }

            const newStrRange = newEnd - start
            const addedStr = newStr.substr(start, newStrRange)
            const replacementRange = end - start

            return [start, addedStr, replacementRange]
            */
        }

    </script>


    <div id="editors"></div>
    <script type="module" src="js/app2.js"></script>
</body>

</html>